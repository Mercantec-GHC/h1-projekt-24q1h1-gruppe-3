@page "/"
@using DomainModels
@inject NavigationManager NavigationManager

<PageTitle>Gamers Lounge</PageTitle>

<div class="section">
	<div class="container text-center">
		<div class="row">
			<div class="left-colum">
				<h2 class="header-top-section">Buy and Sell Used Video Games</h2>
				<p>Discover a wide selection of pre-owned video games and console. Start buying or selling today.</p>
				<a href="" class="btn btn-dark">Start</a>
				<a href="" class="btn btn-dark">Learn More</a>
			</div>
			<div class="right-colum">
				<img src="./Picture/Temp_Picture.jpg" alt="" class="colum-image" />
			</div>
		</div>
	</div>
</div>

<div class="section">
	<h2 class="text">Find Your Favorite Games at Great Prices</h2>
	<p class="text">
		Our platform offers a wide selection af used video games, ensuring you can find your favorite
		titles at affordable prices. With secure payment options and user rating, you can buy with confidence.
	</p>

	<div class="card-container">

		<div class="card-middle-section">
			<div class="card-body">
				<img src="favicon.png" class="logo" />
				<h3 class="card-title">Wide Game Selection</h3>
				<p class="card-text">Browse through a vast collection of games.</p>
			</div>
		</div>
		<div class="card-middle-section">
			<div class="card-body">
				<img src="favicon.png" class="logo" />
				<h3 class="card-title">Secure Payment</h3>
				<p class="card-text">Shop with peace of mind knowing your transactions are secure.</p>
			</div>
		</div>
		<div class="card-middle-section">
			<div class="card-body">
				<img src="favicon.png" class="logo" />
				<h3 class="card-title">User Ratings</h3>
				<p class="card-text">Make informed purchasing decisions with ratings and reviews.</p>
			</div>
		</div>
	</div>
	<div class="button-container-middle-section">
		<a href="" class="btn btn-dark">Learn More</a>
		&nbsp; @*Gives a standard space between the anchors*@
		<a href="" class="btn btn-dark">Sign Up</a>
	</div>
</div>

<div class="section">
	<h2 class="text">Featured</h2>
	<p class="text">Explore our current list of trending games.</p>

	<div class="card-container">
		<div class="card-bottom-section">
			<div class="carousel">
				@for (var i = 0; i < pcGameToShow.Count; i++)
				{
					var localIndex = i;
					<div class="carousel-item @(currentIndexPC == i ? "active" : "")">
						<div class="card-body-bottom" @onclick="@( () => HandleCardClick(pcGameToShow[localIndex].itemID))">
							<h4>PC</h4>
							<img src="./Picture/Temp_Picture.jpg" class="image" />
							<h4 class="game-name">@pcGameToShow[localIndex].gameName</h4>
							<p class="game-genre">@pcGameToShow[localIndex].genre</p>
							<p class="game-price">€ @pcGameToShow[localIndex].price</p>
						</div>
					</div>
				}
			</div>
		</div>
		<div class="card-bottom-section">
			@for (var i = 0; i < psGameToShow.Count; i++)
			{
				var localIndex = i;
				<div class="carousel-item @(currentIndexPS == i ? "active" : "")">
					<div class="card-body-bottom" @onclick="@( () => HandleCardClick(psGameToShow[localIndex].itemID))">
						<h4>PS</h4>
						<img src="./Picture/Temp_Picture.jpg" class="image" />
						<h4 class="game-name">@psGameToShow[localIndex].gameName</h4>
						<p class="game-genre">@psGameToShow[localIndex].genre</p>
						<p class="game-price">€ @psGameToShow[localIndex].price</p>
					</div>
				</div>
			}
		</div>
		<div class="card-bottom-section">
			@for (var i = 0; i < xboxGameToShow.Count; i++)
			{
				var localIndex = i;
				<div class="carousel-item @(currentIndexXBOX == i ? "active" : "")">
					<div class="card-body-bottom" @onclick="@( () => HandleCardClick(xboxGameToShow[localIndex].itemID))">
						<h4>XBOX</h4>
						<img src="./Picture/Temp_Picture.jpg" class="image" />
						<h4 class="game-name">@xboxGameToShow[localIndex].gameName</h4>
						<p class="game-genre">@xboxGameToShow[localIndex].genre</p>
						<p class="game-price">€ @xboxGameToShow[localIndex].price</p>
					</div>
				</div>
			}
		</div>
	</div>
</div>

@code {
	public List<PC_Game> pcGameToShow;
	public List<XBOX_Game> xboxGameToShow;
	public List<PS_Game> psGameToShow;
	public int currentIndexPC = 0;
	public int currentIndexPS = 0;
	public int currentIndexXBOX = 0;
	private System.Timers.Timer timer;

	protected override void OnInitialized()
	{
		pcGameToShow = FiltreToPC_Games(DB.allItems);
		psGameToShow = FiltreToPS_Games(DB.allItems);
		xboxGameToShow = FiltreToXBOX_Games(DB.allItems);

		timer = new System.Timers.Timer(8000);
		timer.Elapsed += TimerElapsed;
		timer.Start();
	}

	private void HandleCardClick(int gameID)
	{
		NavigationManager.NavigateTo($"/product/{gameID}");
	}

	private void TimerElapsed(object sender, System.Timers.ElapsedEventArgs e)
	{
		NextGame();
		InvokeAsync(StateHasChanged);
	}

	private void NextGame()
	{
		currentIndexPC = (currentIndexPC + 1) % pcGameToShow.Count;
		currentIndexPS = (currentIndexPS + 1) % psGameToShow.Count;
		currentIndexXBOX = (currentIndexXBOX + 1) % xboxGameToShow.Count;
	}

	public List<PC_Game> FiltreToPC_Games(List<Item> games)
	{
		List<PC_Game> pcGameToShow = new List<PC_Game>();

		foreach (var game in games)
		{
			if (game is PC_Game pcGame)
			{
				pcGameToShow.Add(pcGame);
			}
		}
		return pcGameToShow;
	}

	public List<PS_Game> FiltreToPS_Games(List<Item> games)
	{
		List<PS_Game> psGameToShow = new List<PS_Game>();

		foreach (var game in games)
		{
			if (game is PS_Game psGame)
			{
				psGameToShow.Add(psGame);
			}
		}
		return psGameToShow;
	}

	public List<XBOX_Game> FiltreToXBOX_Games(List<Item> games)
	{
		List<XBOX_Game> xboxGameToShow = new List<XBOX_Game>();

		foreach (var game in games)
		{
			if (game is XBOX_Game xboxGame)
			{
				xboxGameToShow.Add(xboxGame);
			}
		}
		return xboxGameToShow;
	}
}